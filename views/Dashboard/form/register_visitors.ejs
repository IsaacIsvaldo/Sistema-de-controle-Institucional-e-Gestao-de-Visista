<!DOCTYPE html>
<html lang="en">

<%- include('../partials/geral/head') %>

<body class="has-navbar-vertical-aside navbar-vertical-aside-show-xl   footer-offset">

  <script src="assets/js/hs.theme-appearance.js"></script>
  <script src="assets/vendor/hs-navbar-vertical-aside/dist/hs-navbar-vertical-aside-mini-cache.js"></script>
  <!-- ========== HEADER ========== -->
  <header id="header" class="navbar navbar-expand-lg navbar-fixed navbar-height navbar-container navbar-bordered bg-white">
    <div class="navbar-nav-wrap">
      <!-- Logo -->
      <%- include('../partials/geral/logo') %>
      <!-- End Logo -->

      <%- include('../partials/geral/navbar') %>
    </div>
  </header>

  <!-- ========== END HEADER ========== -->

  <!-- ========== MAIN CONTENT ========== -->
  <!-- Navbar Vertical -->

  <aside class="js-navbar-vertical-aside navbar navbar-vertical-aside navbar-vertical navbar-vertical-fixed navbar-expand-xl navbar-bordered bg-white  ">
    <div class="navbar-vertical-container">
      <div class="navbar-vertical-footer-offset">
        <!-- Logo -->

        <%- include('../partials/geral/logo') %>

        <!-- End Logo -->

        <!-- Navbar Vertical Toggle -->
        <button type="button" class="js-navbar-vertical-aside-toggle-invoker navbar-aside-toggler">
          <i class="bi-arrow-bar-left navbar-toggler-short-align" data-bs-template='<div class="tooltip d-none d-md-block" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>' data-bs-toggle="tooltip" data-bs-placement="right" title="Collapse"></i>
          <i class="bi-arrow-bar-right navbar-toggler-full-align" data-bs-template='<div class="tooltip d-none d-md-block" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>' data-bs-toggle="tooltip" data-bs-placement="right" title="Expand"></i>
        </button>

        <!-- End Navbar Vertical Toggle -->

        <!-- Content -->
        <% if(user.designacaoGrupo=="Escala de serviço") {%> 
          <%-  include('../partials/escalas/content') %>
           <% }else if(user.designacaoGrupo=="Gestão de Visitas"){%>
            <%-include('../partials/visitas/content') %>
            <% }else if(user.designacaoGrupo=="Posto Médico"){%>
              <%-include('../partials/clinic/content') %>
             <% }else{%>
             <%-  include('../partials/admin/content') %> 
             <% } %>
      
        <!-- End Content -->
        <!-- Footer -->
        <div class="navbar-vertical-footer">
          <ul class="navbar-vertical-footer-list">
          </ul>
        </div>
        <!-- End Footer -->
      </div>
    </div>
  </aside>

  <!-- End Navbar Vertical -->

  <main id="content" role="main" class="main">
    <!-- Content -->
    <div class="content container-fluid">
      <!-- Page Header -->
      <form class="js-step-form py-md-5" data-hs-step-form-options='{
        "progressSelector": "#addUserStepFormProgress",
        "stepsSelector": "#addUserStepFormContent",
        "endSelector": "#addUserFinishBtn",
        "isValidate": false
      }'>
  <div class="row justify-content-lg-center">
    <div class="col-lg-8">
      <!-- Step -->
      <ul id="addUserStepFormProgress" class="js-step-progress step step-sm step-icon-sm step step-inline step-item-between mb-3 mb-md-5">
        <li class="step-item">
          <a class="step-content-wrapper" href="javascript:;" data-hs-step-form-next-options='{
              "targetSelector": "#addUserStepProfile"
            }'>
            <span class="step-icon step-icon-soft-dark">1</span>
            <div class="step-content">
              <span class="step-title">Profile</span>
            </div>
          </a>
        </li>

        <li class="step-item">
          <a class="step-content-wrapper" href="javascript:;" data-hs-step-form-next-options='{
              "targetSelector": "#addUserStepBillingAddress"
            }'>
            <span class="step-icon step-icon-soft-dark">2</span>
            <div class="step-content">
              <span class="step-title">Billing address</span>
            </div>
          </a>
        </li>

        <li class="step-item">
          <a class="step-content-wrapper" href="javascript:;" data-hs-step-form-next-options='{
              "targetSelector": "#addUserStepConfirmation"
            }'>
            <span class="step-icon step-icon-soft-dark">3</span>
            <div class="step-content">
              <span class="step-title">Confirmation</span>
            </div>
          </a>
        </li>
      </ul>
      <!-- End Step -->

      <!-- Content Step Form -->
      <div id="addUserStepFormContent">
        <!-- Card -->
        <div id="addUserStepProfile" class="card card-lg active">
          <!-- Body -->
          <div class="card-body">
            <!-- Form -->
            <div class="row mb-4">
              <label class="col-sm-3 col-form-label form-label">Avatar</label>

              <div class="col-sm-9">
                <div class="d-flex align-items-center">
                  <!-- Avatar -->
                  <label class="avatar avatar-xl avatar-circle avatar-uploader me-5" for="avatarUploader">
                    <img id="avatarImg" class="avatar-img" src="assets/img/160x160/img1.jpg" alt="Image Description">
                  </label>
                  <!-- End Avatar -->

                </div>
              </div>
            </div>
            <!-- End Form -->

            <!-- Form -->
            <div class="row mb-4">
              <label for="firstNameLabel" class="col-sm-3 col-form-label form-label">Full name <i class="bi-question-circle text-body ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="Displayed on public forums, such as Front."></i></label>

              <div class="col-sm-9">
                <div class="input-group input-group-sm-vertical">
                  <input type="text" class="form-control" name="nome" id="nomeID" placeholder="Clarice" aria-label="Clarice">
                  <input type="text" class="form-control" name="sobrenome" id="sobrenomeID" placeholder="Boone" aria-label="Boone">
                </div>
              </div>
            </div>
            <!-- End Form -->

         

            <!-- Form -->
            <div class="js-add-field row mb-4" data-hs-add-field-options='{
                    "template": "#addPhoneFieldTemplate",
                    "container": "#addPhoneFieldContainer",
                    "defaultCreated": 0
                  }'>
              <label for="phoneLabel" class="col-sm-3 col-form-label form-label">Phone <span class="form-label-secondary">(Optional)</span></label>

              <div class="col-sm-9">
                <div class="input-group input-group-sm-vertical">
                  <input type="text" class="js-input-mask form-control number" name="phone" id="phoneLabel" placeholder="+x(xxx)xxx-xx-xx" aria-label="+x(xxx)xxx-xx-xx" data-hs-mask-options='{
                    "mask": "+(244)000-000-000"
                         }'>

                  <!-- Select -->
                  <div class="tom-select-custom tom-select-custom-end">
                    <select class="js-select form-select" autocomplete="off" data-hs-tom-select-options='{
                              "searchInDropdown": false,
                              "hideSearch": true,
                              "dropdownWidth": "8rem"
                            }'>
                      <option value="Mobile" selected>Mobile</option>
                      <option value="Home">Home</option>
                      <option value="Work">Work</option>
                      <option value="Fax">Fax</option>
                      <option value="Direct">Direct</option>
                    </select>
                  </div>
                  <!-- End Select -->
                </div>

                <!-- Container For Input Field -->
                <div id="addPhoneFieldContainer"></div>

                <a class="js-create-field form-link" href="javascript:;">
                  <i class="bi-plus"></i> Add phone
                </a>
              </div>
            </div>
            <!-- End Form -->

            <!-- Add Phone Input Field -->
            <div id="addAddressFieldTemplate" style="display: none;">
              <div class="input-group-add-field">
                <input type="text" class="form-control" data-name="addressLine" placeholder="Your address" aria-label="Your address">

                <a class="js-delete-field input-group-add-field-delete" href="javascript:;">
                  <i class="bi-x-lg"></i>
                </a>
              </div>
            </div>
            <!-- End Add Phone Input Field -->

            <!-- Add Phone Input Field -->
            <div id="addPhoneFieldTemplate" class="input-group-add-field" style="display: none;">
              <div class="input-group input-group-sm-vertical align-items-center">
                <input type="text" class="js-input-mask form-control number"  data-name="additionlPhone" placeholder="+x(xxx)xxx-xx-xx" aria-label="+x(xxx)xxx-xx-xx" data-hs-mask-options='{
                         "mask": "+(244)000-000-000"
                       }'>

                <div class="input-group-append">
                  <!-- Select -->
                  <div class="tom-select-custom tom-select-custom-end">
                    <select class="js-select-dynamic form-select" autocomplete="off" data-name="phoneSelect" data-hs-tom-select-options='{
                              "searchInDropdown": false,
                              "hideSearch": true,
                              "dropdownWidth": "8rem"
                            }'>
                      <option value="Mobile" selected>Mobile</option>
                      <option value="Home">Home</option>
                      <option value="Work">Work</option>
                      <option value="Fax">Fax</option>
                      <option value="Direct">Direct</option>
                    </select>
                  </div>
                  <!-- End Select -->
                </div>
              </div>

              <a class="js-delete-field input-group-add-field-delete" href="javascript:;">
                <i class="bi-x-lg"></i>
              </a>
            </div>
          
          </div>
          <!-- End Body -->
          
          <!-- Footer -->
          <div class="card-footer d-flex justify-content-end align-items-center">
            <button type="button" class="btn btn-primary" data-hs-step-form-next-options='{
                      "targetSelector": "#addUserStepBillingAddress"
                    }'>
              Next <i class="bi-chevron-right"></i>
            </button>
          </div>
          <!-- End Footer -->
        </div>
        <!-- End Card -->

        <div id="addUserStepBillingAddress" class="card card-lg" style="display: none;">
          <!-- Body -->
          <div class="card-body">
         

           

        

            <!-- Form -->
            <div class="row">
              <label for="identify" class="col-sm-3 col-form-label form-label">Tipo de Identificação <i class="bi-question-circle text-body ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="You can find your code in a postal address."></i></label>
              <div class="col-sm-9">
              <select class="js-select-dynamic form-select" autocomplete="off" data-name="phoneSelect" data-hs-tom-select-options='{
                "searchInDropdown": false,
                "hideSearch": true,
                "dropdownWidth": "8rem"
              }' name="pefil" id="tipo_identifiID">
              <% typer.forEach(p => { %>
                <option value="<%=p.tipo_identifiID  %>" ><%=p.designacao %></option>   
              <% }) %>
        
      
      
             </select>
             </div>
              <label for="identify" class="col-sm-3 col-form-label form-label">Doc. Number <i class="bi-question-circle text-body ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="You can find your code in a postal address."></i></label>

              <div class="col-sm-9">
                <input type="text" class="js-input-mask form-control" name="identify" id="identifyID" placeholder="Your zip code" aria-label="Your zip code">
              </div>
              <label for="identify" class="col-sm-3 col-form-label form-label">Validade <i class="bi-question-circle text-body ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="You can find your code in a postal address."></i></label>

              <div class="col-sm-9">
                <input type="date" class="js-input-mask form-control" name="validade" id="validadeID" placeholder="Your zip code" aria-label="Your zip code">
              </div>
              
            </div>
            <!-- End Form -->
            
          </div>
          <!-- End Body -->
         
          <!-- Footer -->
          <div class="card-footer d-flex align-items-center">
            <button type="button" class="btn btn-ghost-secondary" data-hs-step-form-prev-options='{
                 "targetSelector": "#addUserStepProfile"
               }'>
              <i class="bi-chevron-left"></i> Previous step
            </button>

            <div class="ms-auto">
              <button type="button" class="btn btn-primary" data-hs-step-form-next-options='{
                        "targetSelector": "#addUserStepConfirmation"
                      }'>
                Next <i class="bi-chevron-right"></i>
              </button>
            </div>
          </div>
          <!-- End Footer -->
        </div>

        <div id="addUserStepConfirmation" class="card card-lg" style="display: none;">
         
          <div class="card-body">
            <div class="text-center">
              <img class="img-fluid mb-3" src="assets/svg/illustrations/oc-hi-five.svg" alt="Image Description" data-hs-theme-appearance="default" style="max-width: 15rem;">
              <img class="img-fluid mb-3" src="assets/svg/illustrations-light/oc-hi-five.svg" alt="Image Description" data-hs-theme-appearance="dark" style="max-width: 15rem;">
 
              <div class="mb-4">
                <h4 id="result" class="fw-semi-bold text-dark"></h4>
               
              </div>

             
            </div>
            <!-- End Row -->
          </div>
          <!-- End Body -->

          <!-- Footer -->
          <div class="card-footer d-sm-flex align-items-sm-center">
            <button type="button" class="btn btn-ghost-secondary mb-2 mb-sm-0" data-hs-step-form-prev-options='{
                 "targetSelector": "#addUserStepBillingAddress"
               }'>
              <i class="bi-chevron-left"></i> Previous step
            </button>

            <div class="ms-auto">
              <button type="button" class="btn btn-white me-2">Save in drafts</button>
              <button type="button"  onclick="postData()" class="btn btn-primary">Submeter dados</button>
            </div>
          </div>
          <!-- End Footer -->
        </div>
      </div>
      <!-- End Content Step Form -->

   
    </div>
  </div>
  <!-- End Row -->
</form>
   
  
    </div>

<%- include('../partials/geral/footer') %>    <!-- End Content -->
  </main>

  <script src="/assets/js/vendor.min.js"></script>
  <script src="/assets/vendor/chartjs-plugin-datalabels/dist/chartjs-plugin-datalabels.min.js"></script>
  <script src="/assets/js/theme.min.js"></script>
  <script src="/assets/js/hs.theme-appearance-charts.js"></script>
  <%- include('../alerts/alerts') %>
  <input type="hidden" id="domainID" value="<%= domain%>" />
<script>
  const domain = document.getElementById("domainID").value;
  function postData(){
  const  number= document.getElementsByClassName('number');
    let c=[];
    let i=[];
    for (const element of number) {
     c.push({ contacto: element.value });
   }
  
   const  nome= document.getElementById('nomeID').value;
   const  num_identificacao= document.getElementById('identifyID').value;
   const  sobrenome= document.getElementById('sobrenomeID').value;
   const  tipo_identify= document.getElementById('tipo_identifiID').value;
   const  validade= document.getElementById('validadeID').value;
 
  function getDataAtual() {
    const dataAtual = new Date();
    const ano = dataAtual.getFullYear();
    const mes = String(dataAtual.getMonth() + 1).padStart(2, '0');
    const dia = String(dataAtual.getDate()).padStart(2, '0');
    return `${ano}-${mes}-${dia}`;
}
const today =getDataAtual()
  const data = {
    nome:nome,
    identify:i,
    sobrenome:sobrenome,
    num_identificacao,
     fk_tipo_identificacao:parseInt(tipo_identify),
     validade,
    contactos:c
    };
    if(validade < today){
    document.getElementById('result').innerHTML ="Este Documento Ja esta fora do prazo de Valiade !"; 
    document.getElementById('result').setAttribute('class', 'text-danger')
    }else if(validade=="") {
     document.getElementById('result').innerHTML ="Informe a data de validade da documentação !"; 
    document.getElementById('result').setAttribute('class', 'text-danger')
    }else{
        const options = {
      method: 'POST',
      headers: {
        "Content-Type": "application/json", // Tipo de conteúdo do corpo da requisição
      },
      body: JSON.stringify(data),
     
    };
    fetch(`${domain}/Add_visitor`,options)
      .then((response) => response.json())
      .then((data) => {
        console.log(data);
        if(data.error){
    document.getElementById('result').innerHTML =data.error; 
    document.getElementById('result').setAttribute('class', 'text-danger')
  }else{
    document.getElementById('result').innerHTML =data.sucess;
    document.getElementById('result').setAttribute('class', 'text-success')
    window.location="/Visitantes"
  }
 }).catch((error) => {   
       console.log(error)
      });
 
   
  }
    }
   

</script>
  <!-- JS Plugins Init. -->
  <script>
    (function() {
      window.onload = function () {
        

        // INITIALIZATION OF NAVBAR VERTICAL ASIDE
        // =======================================================
        new HSSideNav('.js-navbar-vertical-aside').init()


        // INITIALIZATION OF FORM SEARCH
        // =======================================================
        new HSFormSearch('.js-form-search')


        // INITIALIZATION OF BOOTSTRAP DROPDOWN
        // =======================================================
        HSBsDropdown.init()


        // INITIALIZATION OF FILE ATTACH
        // =======================================================
        new HSFileAttach('.js-file-attach')


        // INITIALIZATION OF STEP FORM
        // =======================================================
        new HSStepForm('.js-step-form', {
          finish: () => {
            document.getElementById("addUserStepFormProgress").style.display = 'none'
            document.getElementById("addUserStepProfile").style.display = 'none'
            document.getElementById("addUserStepBillingAddress").style.display = 'none'
            document.getElementById("addUserStepConfirmation").style.display = 'none'
            document.getElementById("successMessageContent").style.display = 'block'
            scrollToTop('#header');
            const formContainer = document.getElementById('formContainer')
          },
          onNextStep: function () {
            scrollToTop()
          },
          onPrevStep: function () {
            scrollToTop()
          }
        })

        function scrollToTop(el = '.js-step-form') {
          el = document.querySelector(el)
          window.scrollTo({
            top: (el.getBoundingClientRect().top + window.scrollY) - 30,
            left: 0,
            behavior: 'smooth'
          })
        }


        // INITIALIZATION OF ADD FIELD
        // =======================================================
        new HSAddField('.js-add-field', {
          addedField: field => {
            HSCore.components.HSTomSelect.init(field.querySelector('.js-select-dynamic'))
            HSCore.components.HSMask.init(field.querySelector('.js-input-mask'))
          }
        })


        // INITIALIZATION OF SELECT
        // =======================================================
        HSCore.components.HSTomSelect.init('.js-select', {
          render: {
            'option': function (data, escape) {
              return data.optionTemplate || `<div>${data.text}</div>>`
            },
            'item': function (data, escape) {
              return data.optionTemplate || `<div>${data.text}</div>>`
            }
          }
        })


        // INITIALIZATION OF INPUT MASK
        // =======================================================
        HSCore.components.HSMask.init('.js-input-mask')
      }
    })()
  </script>

  <!-- Style Switcher JS -->

  <script>
      (function () {
        // STYLE SWITCHER
        // =======================================================
        const $dropdownBtn = document.getElementById('selectThemeDropdown') // Dropdowon trigger
        const $variants = document.querySelectorAll(`[aria-labelledby="selectThemeDropdown"] [data-icon]`) // All items of the dropdown

        // Function to set active style in the dorpdown menu and set icon for dropdown trigger
        const setActiveStyle = function () {
          $variants.forEach($item => {
            if ($item.getAttribute('data-value') === HSThemeAppearance.getOriginalAppearance()) {
              $dropdownBtn.innerHTML = `<i class="${$item.getAttribute('data-icon')}" />`
              return $item.classList.add('active')
            }

            $item.classList.remove('active')
          })
        }

        // Add a click event to all items of the dropdown to set the style
        $variants.forEach(function ($item) {
          $item.addEventListener('click', function () {
            HSThemeAppearance.setAppearance($item.getAttribute('data-value'))
          })
        })

        // Call the setActiveStyle on load page
        setActiveStyle()

        // Add event listener on change style to call the setActiveStyle function
        window.addEventListener('on-hs-appearance-change', function () {
          setActiveStyle()
        })
      })()
    </script>
</body>
</html>